<!DOCTYPE html>
<html>

<head>
    <!-- Required meta tags -->
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

    <!-- Bootstrap CSS -->
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.4.1/css/bootstrap.min.css" integrity="sha384-Vkoo8x4CGsO3+Hhxv8T/Q5PaXtkKtu6ug5TOeNV6gBiFeWPGFN9MuhOf23Q9Ifjh" crossorigin="anonymous">

    <title>Animal Face Test</title>
    <link rel="stylesheet" href="style.css">
</head>

<body>
    <nav class="navbar navbar-expand-lg navbar-light bg-light">
        <a class="navbar-brand" href="#">Animal Face Test</a>
    </nav>

    <div class="container">
        <h1 class="text-center my-4">Which animal do you resemble?</h1>

        <div class="image-upload-wrap text-center">
            <input class="file-upload-input" type='file' onchange="readURL(this);" accept="image/*" />
            <div class="drag-text">
                <h3>Drag and drop a face image or click to select a file.</h3>
            </div>
        </div>
        <div class="file-upload-content text-center" style="display:none;">
            <img class="file-upload-image" id="face-image" src="#" alt="your image" />
            <div class="image-title-wrap">
                <button type="button" onclick="removeUpload()" class="remove-image">Remove &nbsp;
                    <span class="image-title">Uploaded Image</span>
                </button>
            </div>
        </div>
        <div id="label-container" class="mt-3"></div>
        <div id="result-description" class="mt-3"></div>
        <div id="celebrities" class="mt-1"></div>
    </div>

    <!-- Bootstrap and TensorFlow.js -->
    <script src="https://code.jquery.com/jquery-3.4.1.slim.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/popper.js@1.16.0/dist/umd/popper.min.js"></script>
    <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.4.1/js/bootstrap.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@tensorflow/tfjs@1.3.1/dist/tf.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@teachablemachine/image@0.8/dist/teachablemachine-image.min.js"></script>
    <script>
        let model, maxPredictions;
    
        // Description and celebrities data
        const descriptions = {
            "cat": {
                description: "With your mysterious gaze and graceful movements, you embody the spirit of a cat. You're independent, a bit aloof, but always curious and deeply affectionate to those you trust.",
                celebrities: "Cat-faced celebrities: Audrey Hepburn, Robert Pattinson, ZoÃ« Kravitz"
            },
            "puppy": {
                description: "With your cute big eyes and a friendly smile, you bring joy to everybody around you! Due to your kind and playful personality, you are always popular with everyone. You become especially more adorable when you are with your bf/gf. When their attention is lacking you can become needy and lonely, but nevertheless are always still so cute, just like a puppy!",
                celebrities: "Puppy-faced celebrities: Park Bo-young, IU, Jang Won-young (IZ*ONE), Ji-soo (BLACKPINK), Choi Yoo-jung (Wikimiki)"
            },
            "rabbit": {
                description: "Your soft features and gentle demeanor resonate with the quiet charm of a rabbit. You're often calm and composed, and you radiate a soothing presence that people find comforting and warm.",
                celebrities: "Rabbit-faced celebrities: Taylor Swift, G-Dragon, Jungkook (BTS)"
            },
            "dinosaur": {
                description: "You have a striking presence that can't be ignored, much like the dinosaurs of old. Your bold and dynamic personality makes you stand out in any crowd, commanding attention wherever you go.",
                celebrities: "Dinosaur-faced celebrities: Chris Pratt (in Jurassic World), Sam Neill"
            }
        };
    
        window.onload = async function () {
            await init();
        };
    
        async function init() {
            const URL = "https://teachablemachine.withgoogle.com/models/q8sOUATEp/";
            const modelURL = URL + "model.json";
            const metadataURL = URL + "metadata.json";
            model = await tmImage.load(modelURL, metadataURL);
            maxPredictions = model.getTotalClasses();
            
            // Ensure the label container is properly initialized with div elements for each class
            labelContainer = document.getElementById("label-container");
            for (let i = 0; i < maxPredictions; i++) {
                const div = document.createElement("div");
                div.id = `label${i}`;  // Assign an ID for easier access
                labelContainer.appendChild(div);
            }
        }
    
        async function predict() {
            var image = document.getElementById("face-image");
            if (!image.src || image.src === "#") {
                console.error("Image not loaded yet.");
                return;
            }
    
            const prediction = await model.predict(image, false);
            let highestPrediction = { className: "", probability: 0 };
            prediction.forEach((p, index) => {
                const element = document.getElementById(`label${index}`);
                const probability = p.probability.toFixed(2);
                element.innerHTML = `${p.className}: ${probability}`;
                if (p.probability > highestPrediction.probability) {
                    highestPrediction = { className: p.className, probability: parseFloat(probability) };
                }
            });
            updateResultDescription(highestPrediction);
        }
    
        function updateResultDescription(highestPrediction) {
            const resultDescription = document.getElementById("result-description");
            const celebs = document.getElementById("celebrities");
            const detail = descriptions[highestPrediction.className];
            resultDescription.innerHTML = `<h4>You mostly resemble a(n): ${highestPrediction.className}</h4><p>${detail.description}</p>`;
            celebs.textContent = detail.celebrities;
        }
    
        function readURL(input) {
            if (input.files && input.files[0]) {
                var reader = new FileReader();
                reader.onload = function (e) {
                    $('.image-upload-wrap').hide();
                    $('.file-upload-image').attr('src', e.target.result);
                    $('.file-upload-content').show();
                    $('.image-title').html(input.files[0].name);
                    predict();
                };
                reader.readAsDataURL(input.files[0]);
            } else {
                removeUpload();
            }
        }
    
        function removeUpload() {
            $('.file-upload-input').replaceWith($('.file-upload-input').clone(true));
            $('.file-upload-content').hide();
            $('.image-upload-wrap').show();
        }
    
        $('.image-upload-wrap').bind('dragover', function () {
            $('.image-upload-wrap').addClass('image-dropping');
        });
        $('.image-upload-wrap').bind('dragleave', function () {
            $('.image-upload-wrap').removeClass('image-dropping');
        });
    </script>
    
</body>

</html>
